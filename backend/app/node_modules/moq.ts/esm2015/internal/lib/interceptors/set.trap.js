import { SetPropertyInteraction } from "../interactions";
import { MoqAPI } from "../moq";
/**
 * @hidden
 */
export class SetTrap {
    constructor(tracker, propertiesValueStorage, interactionPlayer, propertyIsReadOnlyTester) {
        this.tracker = tracker;
        this.propertiesValueStorage = propertiesValueStorage;
        this.interactionPlayer = interactionPlayer;
        this.propertyIsReadOnlyTester = propertyIsReadOnlyTester;
    }
    intercept(target, property, value) {
        const expression = new SetPropertyInteraction(property, value);
        this.tracker.add(expression);
        if (property === MoqAPI) {
            return false;
        }
        if (this.propertyIsReadOnlyTester.isReadOnly(property) === true) {
            return false;
        }
        const accepted = this.interactionPlayer.play(expression);
        if (accepted === true || accepted === undefined) {
            this.propertiesValueStorage.set(property, value);
        }
        return accepted === undefined ? true : accepted;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2V0LnRyYXAuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbW9xL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9pbnRlcmNlcHRvcnMvc2V0LnRyYXAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFHekQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUdoQzs7R0FFRztBQUNILE1BQU0sT0FBTyxPQUFPO0lBQ2hCLFlBQ1ksT0FBZ0IsRUFDaEIsc0JBQThDLEVBQzlDLGlCQUFvQyxFQUNwQyx3QkFBa0Q7UUFIbEQsWUFBTyxHQUFQLE9BQU8sQ0FBUztRQUNoQiwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBQzlDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtJQUU5RCxDQUFDO0lBRU0sU0FBUyxDQUFDLE1BQVcsRUFBRSxRQUFxQixFQUFFLEtBQVU7UUFDM0QsTUFBTSxVQUFVLEdBQUcsSUFBSSxzQkFBc0IsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFL0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFN0IsSUFBSSxRQUFRLEtBQUssTUFBTSxFQUFFO1lBQ3JCLE9BQU8sS0FBSyxDQUFDO1NBQ2hCO1FBRUQsSUFBSSxJQUFJLENBQUMsd0JBQXdCLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtZQUM3RCxPQUFPLEtBQUssQ0FBQztTQUNoQjtRQUVELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDekQsSUFBSSxRQUFRLEtBQUssSUFBSSxJQUFJLFFBQVEsS0FBSyxTQUFTLEVBQUU7WUFDN0MsSUFBSSxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDcEQ7UUFFRCxPQUFPLFFBQVEsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO0lBQ3BELENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRyYWNrZXIgfSBmcm9tIFwiLi4vdHJhY2tlci90cmFja2VyXCI7XG5pbXBvcnQgeyBTZXRQcm9wZXJ0eUludGVyYWN0aW9uIH0gZnJvbSBcIi4uL2ludGVyYWN0aW9uc1wiO1xuaW1wb3J0IHsgUHJvcGVydGllc1ZhbHVlU3RvcmFnZSB9IGZyb20gXCIuL3Byb3BlcnRpZXMtdmFsdWUuc3RvcmFnZVwiO1xuaW1wb3J0IHsgSW50ZXJhY3Rpb25QbGF5ZXIgfSBmcm9tIFwiLi4vaW50ZXJhY3Rpb24tcGxheWVycy9pbnRlcmFjdGlvbi5wbGF5ZXJcIjtcbmltcG9ydCB7IE1vcUFQSSB9IGZyb20gXCIuLi9tb3FcIjtcbmltcG9ydCB7IFByb3BlcnR5SXNSZWFkT25seVRlc3RlciB9IGZyb20gXCIuLi9leHBsb3JlcnMvaGFzLXByb3BlcnR5LmV4cGxvcmVyL3Byb3BlcnR5LWlzLXJlYWQtb25seS50ZXN0ZXJcIjtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmV4cG9ydCBjbGFzcyBTZXRUcmFwIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSB0cmFja2VyOiBUcmFja2VyLFxuICAgICAgICBwcml2YXRlIHByb3BlcnRpZXNWYWx1ZVN0b3JhZ2U6IFByb3BlcnRpZXNWYWx1ZVN0b3JhZ2UsXG4gICAgICAgIHByaXZhdGUgaW50ZXJhY3Rpb25QbGF5ZXI6IEludGVyYWN0aW9uUGxheWVyLFxuICAgICAgICBwcml2YXRlIHByb3BlcnR5SXNSZWFkT25seVRlc3RlcjogUHJvcGVydHlJc1JlYWRPbmx5VGVzdGVyKSB7XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgaW50ZXJjZXB0KHRhcmdldDogYW55LCBwcm9wZXJ0eTogUHJvcGVydHlLZXksIHZhbHVlOiBhbnkpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IG5ldyBTZXRQcm9wZXJ0eUludGVyYWN0aW9uKHByb3BlcnR5LCB2YWx1ZSk7XG5cbiAgICAgICAgdGhpcy50cmFja2VyLmFkZChleHByZXNzaW9uKTtcblxuICAgICAgICBpZiAocHJvcGVydHkgPT09IE1vcUFQSSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcGVydHlJc1JlYWRPbmx5VGVzdGVyLmlzUmVhZE9ubHkocHJvcGVydHkpID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhY2NlcHRlZCA9IHRoaXMuaW50ZXJhY3Rpb25QbGF5ZXIucGxheShleHByZXNzaW9uKTtcbiAgICAgICAgaWYgKGFjY2VwdGVkID09PSB0cnVlIHx8IGFjY2VwdGVkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydGllc1ZhbHVlU3RvcmFnZS5zZXQocHJvcGVydHksIHZhbHVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhY2NlcHRlZCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGFjY2VwdGVkO1xuICAgIH1cbn1cbiJdfQ==